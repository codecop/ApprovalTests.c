name: CI Workflow C Make

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Check out the repo
      uses: actions/checkout@v2
    - name: Install cmocka
      # https://ubuntu.pkgs.org/20.10/ubuntu-universe-amd64/libcmocka-dev_1.1.5-2_amd64.deb.html
      run: sudo apt-get update && sudo apt-get install libcmocka-dev
    - name: Test with make
      run: make test example
    - name: Clean build
      run: make build
    - name: Keep binary files
      uses: actions/upload-artifact@v2
      with:
        name: Binaries_Linux_x64
        path: |
          ./bin
          ./include
          ./lib
          ./src
          ./LICENSE
          ./README.md
